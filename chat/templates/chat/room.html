<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8"/>
        <title id="title">{{ room_name }} | SocialMediaSite</title>

    </head>

    <body>
        <section class="section">
            <div class="container">
              <div class="columns is-multiline">
      
                  <div>
                    <div class="box">     
                      <div id="chat-messages">
                      </div>
                    </div>
      
                    <div class="enter">
                      <div class="control">
                        <input class="input" type="text" placeholder="Message" id="chat-message-input">
                      </div>
                    </div>
      
                    <div class="field">
                      <div class="control">
                        <a class="button" id="chat-message-submit">Send</a>
                      </div>
                    </div>
      
                    <small class="has-text-grey-light">Signed in as: {{ displayName }}</small>
                  </div>
                </div>
             </div>
          </section>
        {{ room_name|json_script:"json-roomname" }}
        {{ displayName|json_script:"json-displayName" }}
        <style>
            .box {
                border:1px solid black;
            }
            .button {
                border:2px solid rgb(30, 108, 224);
            }
            .field {
                margin-top: 50px;
            }
        </style>
        <script>
            const roomName = JSON.parse(document.getElementById('json-roomname').textContent);
            const displayName = JSON.parse(document.getElementById('json-displayName').textContent);


            const chatSocket = new WebSocket(
                'ws://'
                + window.location.host
                + '/ws/chat/'
                + roomName
                + '/'
            );
    
                chatSocket.onclose = function(e) {
                console.error('The socket closed unexpectedly');
            };
    
            chatSocket.onmessage = function(e) {
    
            const data = JSON.parse(e.data);
    
            if (data.message) {
                document.querySelector('#chat-messages').innerHTML += ('<br>' + data.displayName + ': ' + data.message + '');
            } else {
                alert('The message was empty!')
            }
            };
    
            document.querySelector('#chat-message-input').focus();
            document.querySelector('#chat-message-input').onkeyup = function(e) {
            if (e.keyCode === 13) {
                document.querySelector('#chat-message-submit').click();
            }
            };
    
            document.querySelector('#chat-message-submit').onclick = function(e) {
            const messageInputDom = document.querySelector('#chat-message-input');
            const message = messageInputDom.value;
    
            chatSocket.send(JSON.stringify({
                'message': message,
                'displayName': displayName,
                'room': roomName
            }));
    
            messageInputDom.value = '';
            };
        </script>
    </body>
</html>